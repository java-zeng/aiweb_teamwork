# 前端接口对接文档

## 项目概述

本项目是一个基于Spring Boot + FastGPT的智能知识库管理系统，支持用户角色管理、知识库创建、文件上传和智能聊天等功能。

**基础URL**: `http://localhost:8890`

**认证方式**: JWT Token (Bearer Token)

---

## 1. 用户认证模块

### 1.1 用户注册

**接口地址**: `POST /api/auth/register`

**功能描述**: 用户注册新账号

**请求参数**:
```json
{
    "username": "用户名",
    "email": "邮箱地址",
    "password": "密码",
    "confirmPassword": "确认密码"
}
```

**响应示例**:
```json
{
    "code": 1,
    "msg": "注册成功",
    "data": {
        "id": 1,
        "username": "testuser",
        "email": "test@example.com"
    }
}
```

### 1.2 用户登录

**接口地址**: `POST /api/auth/login`

**功能描述**: 用户登录获取JWT Token

**请求参数**:
```json
{
    "username": "用户名",
    "password": "密码"
}
```

**响应示例**:
```json
{
    "code": 1,
    "msg": "登录成功",
    "data": {
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "user": {
            "id": 1,
            "username": "testuser",
            "email": "test@example.com"
        }
    }
}
```

### 1.3 发送验证码

**接口地址**: `POST /api/auth/sendCode`

**功能描述**: 发送邮箱验证码

**请求参数**:
```json
{
    "email": "邮箱地址"
}
```

**响应示例**:
```json
{
    "code": 1,
    "msg": "验证码发送成功",
    "data": null
}
```

### 1.4 忘记密码

**接口地址**: `POST /api/auth/forgot-password`

**功能描述**: 发送密码重置邮件

**请求参数**:
```json
{
    "email": "邮箱地址"
}
```

**响应示例**:
```json
{
    "code": 1,
    "msg": "密码重置邮件发送成功",
    "data": null
}
```

### 1.5 重置密码

**接口地址**: `POST /api/auth/reset-password`

**功能描述**: 使用Token重置密码

**请求参数**:
```json
{
    "token": "重置Token",
    "newPassword": "新密码",
    "confirmPassword": "确认新密码"
}
```

**响应示例**:
```json
{
    "code": 1,
    "msg": "密码重置成功",
    "data": null
}
```

---

## 2. FastGPT服务模块

### 2.1 健康检查

**接口地址**: `GET /api/fastgpt/health`

**功能描述**: 检查FastGPT服务状态

**请求头**:
```
Authorization: Bearer {token}
```

**响应示例**:
```json
{
    "code": 1,
    "msg": "success",
    "data": "FastGPT服务正常运行"
}
```

### 2.2 通用聊天

**接口地址**: `POST /api/fastgpt/chat`

**功能描述**: 与FastGPT进行通用聊天

**请求参数**:
```json
{
    "message": "用户消息",
    "datasetId": "知识库ID（可选）",
    "systemPrompt": "系统提示词（可选）"
}
```

**响应示例**:
```json
{
    "code": 1,
    "msg": "success",
    "data": {
        "reply": "AI回复内容",
        "references": [
            {
                "title": "参考文档标题",
                "content": "参考内容片段"
            }
        ]
    }
}
```

### 2.3 角色知识库聊天

**接口地址**: `POST /api/fastgpt/chat-with-role`

**功能描述**: 使用指定角色的知识库进行聊天

**请求参数**:
```json
{
    "message": "用户消息",
    "roleName": "角色名称（如：产品、销售等）",
    "systemPrompt": "系统提示词（可选）"
}
```

**响应示例**:
```json
{
    "code": 1,
    "msg": "success",
    "data": {
        "reply": "基于角色知识库的AI回复",
        "roleName": "产品",
        "knowledgeBaseId": "68f86040470e057116de2cb8",
        "references": [
            {
                "title": "产品功能文档",
                "content": "相关文档内容片段"
            }
        ]
    }
}
```

### 2.4 获取用户角色列表

**接口地址**: `GET /api/fastgpt/user-roles`

**功能描述**: 获取当前用户的所有角色列表

**响应示例**:
```json
{
    "code": 1,
    "msg": "success",
    "data": {
        "roles": ["产品", "销售", "技术", "客服"],
        "count": 4
    }
}
```

---

## 3. 角色知识库管理模块

### 3.1 选择角色并创建知识库

**接口地址**: `POST /api/fastgpt/select-role`

**功能描述**: 为用户选择角色并创建对应的知识库

**请求参数**:
```json
{
    "roleName": "角色名称"
}
```

**响应示例**:
```json
{
    "code": 1,
    "msg": "角色选择成功",
    "data": {
        "id": 1,
        "userId": 1,
        "username": "testuser",
        "roleName": "产品",
        "knowledgeBaseId": "68f86040470e057116de2cb8",
        "knowledgeBaseName": "testuser_产品知识库",
        "createTime": "2025-10-22T12:00:00",
        "updateTime": "2025-10-22T12:00:00"
    }
}
```

### 3.2 获取用户角色知识库列表

**接口地址**: `GET /api/fastgpt/role-knowledge-bases`

**功能描述**: 获取当前用户的所有角色知识库

**响应示例**:
```json
{
    "code": 1,
    "msg": "success",
    "data": [
        {
            "id": 1,
            "userId": 1,
            "username": "testuser",
            "roleName": "产品",
            "knowledgeBaseId": "68f86040470e057116de2cb8",
            "knowledgeBaseName": "testuser_产品知识库",
            "createTime": "2025-10-22T12:00:00",
            "updateTime": "2025-10-22T12:00:00",
            "files": [
                {
                    "id": 1,
                    "fileName": "产品介绍.pdf",
                    "fileSize": 1024000,
                    "fileType": "pdf",
                    "uploadTime": "2025-10-22T12:30:00"
                }
            ]
        }
    ]
}
```

### 3.3 获取特定角色的知识库详情

**接口地址**: `GET /api/fastgpt/role-knowledge-bases/{roleName}`

**功能描述**: 获取指定角色的知识库详情和文件列表

**路径参数**:
- `roleName`: 角色名称

**响应示例**:
```json
{
    "code": 1,
    "msg": "success",
    "data": {
        "id": 1,
        "userId": 1,
        "username": "testuser",
        "roleName": "产品",
        "knowledgeBaseId": "68f86040470e057116de2cb8",
        "knowledgeBaseName": "testuser_产品知识库",
        "createTime": "2025-10-22T12:00:00",
        "updateTime": "2025-10-22T12:00:00",
        "files": [
            {
                "id": 1,
                "fileName": "产品介绍.pdf",
                "fileSize": 1024000,
                "fileType": "pdf",
                "uploadTime": "2025-10-22T12:30:00",
                "status": "completed"
            }
        ]
    }
}
```

### 3.4 删除角色知识库

**接口地址**: `DELETE /api/fastgpt/role-knowledge-bases/{roleName}`

**功能描述**: 删除指定角色的知识库

**路径参数**:
- `roleName`: 角色名称

**响应示例**:
```json
{
    "code": 1,
    "msg": "删除成功",
    "data": null
}
```

---

## 4. 文件上传模块

### 4.1 通用文件上传

**接口地址**: `POST /api/fastgpt/upload`

**功能描述**: 上传文件到默认知识库

**请求参数**:
- `files`: 文件列表 (multipart/form-data)
- `datasetId`: 知识库ID (可选)
- `parentId`: 父级ID (可选)
- `chunkSize`: 分块大小 (可选)

**响应示例**:
```json
{
    "code": 1,
    "msg": "上传成功",
    "data": {
        "totalFiles": 2,
        "successCount": 2,
        "failCount": 0,
        "results": [
            {
                "documentId": 1,
                "filename": "文档1.pdf",
                "status": "success"
            },
            {
                "documentId": 2,
                "filename": "文档2.docx",
                "status": "success"
            }
        ]
    }
}
```

### 4.2 角色知识库文件上传

**接口地址**: `POST /api/fastgpt/upload-with-role`

**功能描述**: 上传文件到指定角色的知识库

**请求参数**:
- `files`: 文件列表 (multipart/form-data)
- `roleName`: 角色名称
- `parentId`: 父级ID (可选)
- `chunkSize`: 分块大小 (可选)

**响应示例**:
```json
{
    "code": 1,
    "msg": "上传成功",
    "data": {
        "totalFiles": 1,
        "successCount": 1,
        "failCount": 0,
        "roleName": "产品",
        "knowledgeBaseId": "68f86040470e057116de2cb8",
        "results": [
            {
                "documentId": 1,
                "filename": "产品介绍.pdf",
                "status": "success",
                "roleName": "产品",
                "knowledgeBaseId": "68f86040470e057116de2cb8"
            }
        ]
    }
}
```

### 4.3 获取用户文档列表

**接口地址**: `GET /api/fastgpt/documents`

**功能描述**: 获取当前用户的所有文档

**响应示例**:
```json
{
    "code": 1,
    "msg": "success",
    "data": [
        {
            "id": 1,
            "username": "testuser",
            "datasetId": "68f86040470e057116de2cb8",
            "originalFilename": "产品介绍.pdf",
            "fileSize": 1024000,
            "fileType": "pdf",
            "status": "completed",
            "fastgptDocumentId": "doc_123456",
            "createdTime": "2025-10-22T12:30:00",
            "updatedTime": "2025-10-22T12:30:00"
        }
    ]
}
```

### 4.4 删除文档

**接口地址**: `DELETE /api/fastgpt/documents/{documentId}`

**功能描述**: 删除指定文档

**路径参数**:
- `documentId`: 文档ID

**响应示例**:
```json
{
    "code": 1,
    "msg": "删除成功",
    "data": null
}
```

---

## 5. 用户管理模块

### 5.1 获取用户信息

**接口地址**: `GET /api/user/profile`

**功能描述**: 获取当前用户信息

**响应示例**:
```json
{
    "code": 1,
    "msg": "success",
    "data": {
        "id": 1,
        "username": "testuser",
        "email": "test@example.com",
        "createdTime": "2025-10-22T10:00:00",
        "lastLoginTime": "2025-10-22T12:00:00"
    }
}
```

### 5.2 更新用户信息

**接口地址**: `PUT /api/user/profile`

**功能描述**: 更新用户信息

**请求参数**:
```json
{
    "email": "newemail@example.com",
    "password": "新密码（可选）"
}
```

**响应示例**:
```json
{
    "code": 1,
    "msg": "更新成功",
    "data": {
        "id": 1,
        "username": "testuser",
        "email": "newemail@example.com",
        "updatedTime": "2025-10-22T12:30:00"
    }
}
```

### 5.3 删除用户账号

**接口地址**: `DELETE /api/user/account`

**功能描述**: 删除当前用户账号（包括所有相关数据）

**响应示例**:
```json
{
    "code": 1,
    "msg": "账号删除成功",
    "data": null
}
```

---

## 6. 错误码说明

### 6.1 通用错误码

| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| 0 | 请求失败 | 检查请求参数和业务逻辑 |
| 1 | 请求成功 | - |
| 400 | 请求参数错误 | 检查请求参数格式 |
| 401 | 未认证 | 重新登录获取Token |
| 403 | 权限不足 | 检查用户权限 |
| 404 | 资源不存在 | 检查请求路径和资源ID |
| 500 | 服务器内部错误 | 联系技术支持 |

### 6.2 业务错误码

| 错误码 | 说明 | 解决方案 |
|--------|------|----------|
| 1001 | 用户名已存在 | 更换用户名 |
| 1002 | 邮箱已存在 | 更换邮箱 |
| 1003 | 密码格式不正确 | 使用符合要求的密码格式 |
| 1004 | 验证码错误 | 重新获取验证码 |
| 1005 | Token已过期 | 重新登录 |
| 2001 | 角色知识库已存在 | 选择其他角色或删除现有知识库 |
| 2002 | 角色知识库不存在 | 先创建角色知识库 |
| 2003 | 文件上传失败 | 检查文件格式和大小 |
| 2004 | FastGPT服务不可用 | 检查FastGPT服务状态 |

---

## 7. 请求头说明

### 7.1 通用请求头

```
Content-Type: application/json
Authorization: Bearer {JWT_TOKEN}
```

### 7.2 文件上传请求头

```
Content-Type: multipart/form-data
Authorization: Bearer {JWT_TOKEN}
```

---

## 8. 响应格式说明

### 8.1 成功响应格式

```json
{
    "code": 1,
    "msg": "success",
    "data": {
        // 具体数据内容
    }
}
```

### 8.2 错误响应格式

```json
{
    "code": 0,
    "msg": "错误信息",
    "data": null
}
```

---

## 9. 前端集成示例

### 9.1 用户登录流程

```javascript
// 1. 用户登录
const loginResponse = await fetch('/api/auth/login', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        username: 'testuser',
        password: 'password123'
    })
});

const loginData = await loginResponse.json();
if (loginData.code === 1) {
    // 保存Token
    localStorage.setItem('token', loginData.data.token);
}
```

### 9.2 创建角色知识库

```javascript
// 2. 创建角色知识库
const createRoleResponse = await fetch('/api/fastgpt/select-role', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('token')}`
    },
    body: JSON.stringify({
        roleName: '产品'
    })
});

const roleData = await createRoleResponse.json();
console.log('角色知识库创建结果:', roleData);
```

### 9.3 上传文件到角色知识库

```javascript
// 3. 上传文件
const formData = new FormData();
formData.append('files', fileInput.files[0]);
formData.append('roleName', '产品');

const uploadResponse = await fetch('/api/fastgpt/upload-with-role', {
    method: 'POST',
    headers: {
        'Authorization': `Bearer ${localStorage.getItem('token')}`
    },
    body: formData
});

const uploadData = await uploadResponse.json();
console.log('文件上传结果:', uploadData);
```

### 9.4 角色知识库聊天

```javascript
// 4. 角色知识库聊天
const chatResponse = await fetch('/api/fastgpt/chat-with-role', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('token')}`
    },
    body: JSON.stringify({
        message: '请介绍一下我们的产品功能',
        roleName: '产品',
        systemPrompt: '你是一个专业的产品经理，请基于知识库内容回答用户问题。'
    })
});

const chatData = await chatResponse.json();
console.log('聊天回复:', chatData.data.reply);
```

---

## 10. 注意事项

### 10.1 认证要求
- 除登录、注册、发送验证码等接口外，所有接口都需要JWT Token认证
- Token需要在请求头中携带：`Authorization: Bearer {token}`

### 10.2 文件上传限制
- 支持的文件类型：PDF、DOC、DOCX、TXT等
- 单个文件大小限制：100MB
- 支持批量上传多个文件

### 10.3 角色知识库命名规则
- 知识库名称格式：`{username}_{roleName}知识库`
- 例如：`testuser_产品知识库`

### 10.4 错误处理
- 所有接口都返回统一的响应格式
- 前端需要根据`code`字段判断请求是否成功
- 错误信息在`msg`字段中

### 10.5 分页和排序
- 列表接口支持分页参数：`page`、`size`
- 支持排序参数：`sort`、`order`

---

## 11. 测试接口

### 11.1 健康检查
```bash
curl -X GET "http://localhost:8890/api/fastgpt/health"
```

### 11.2 用户登录
```bash
curl -X POST "http://localhost:8890/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username": "testuser", "password": "password123"}'
```

### 11.3 创建角色知识库
```bash
curl -X POST "http://localhost:8890/api/fastgpt/select-role" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"roleName": "产品"}'
```

### 11.4 角色知识库聊天
```bash
curl -X POST "http://localhost:8890/api/fastgpt/chat-with-role" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "message": "请介绍一下我们的产品功能",
    "roleName": "产品",
    "systemPrompt": "你是一个专业的产品经理"
  }'
```

---

## 12. 更新日志

### v1.0.0 (2025-10-22)
- 初始版本发布
- 支持用户认证和角色管理
- 支持角色知识库创建和管理
- 支持文件上传和智能聊天
- 支持角色知识库聊天功能

---

**文档版本**: v1.0.0  
**最后更新**: 2025-10-22  
**维护人员**: 开发团队
